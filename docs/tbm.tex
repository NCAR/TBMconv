\documentclass{report}
\usepackage{amsmath}
\usepackage[margin=0.75in]{geometry}
\usepackage{array} % for the 'm' table column specifier
\usepackage{multicol}
\usepackage{multirow}
\usepackage{tikz}
\usepackage{booktabs}
\usepackage{hyperref}
\usepackage{cleveref}
\usepackage{adjustbox}
\usepackage{listings}

\usetikzlibrary{fit}

\lstset{
	tabsize=3,
	basicstyle=\ttfamily\footnotesize,
	upquote=\true,
	columns=fixed,
	showstringspaces=false,
	breaklines=true,
	frame=single,
	showspaces=false,
	keywordstyle=\color[rgb]{0,0,1},
	commentstyle=\color[rgb]{0.13,0.54,0.13},
	stringstyle=\color[rgb]{0.63,0.13,0.94}
}

%\usepackage{PTSansNarrow}
\usepackage[T1]{fontenc}

\newcolumntype{C}[1]{>{\fontfamily{phv}\fontseries{mc}\selectfont\centering\let\newline\\\arraybackslash\hspace{0pt}}m{6.5pt}|}
%\newcolumntype{T}[1]{>{\fontfamily{ttfamily}\selectfont\let\newline\\\arraybackslash}l|}
\newcolumntype{T}{>{\ttfamily}l}

%\renewcommand*\sfdefault{\sfdefault}
\renewcommand*\familydefault{\sfdefault}

\newcommand{\rotate}[1]{\tikz{\node[rotate=90]{\textsf{#1}};}}

\newcommand{\controlword}[1]{
{\scriptsize
%\sfdefault
\setlength{\tabcolsep}{0.7pt}
\begin{center}
\begin{tabular}{|C|C|C|C|C|C|C|C|C|C|C|C|C|C|C|C|C|C|C|C|C|C|C|C|C|C|C|C|C|C|C|C|C|C|C|C|C|C|C|C|C|C|C|C|C|C|C|C|C|C|C|C|C|C|C|C|C|C|C|C|}
\hline
59 & 58 & 57 & 56 & 55 & 54 & 53 & 52 & 51 & 50 &
49 & 48 & 47 & 46 & 45 & 44 & 43 & 42 & 41 & 40 &
39 & 38 & 37 & 36 & 35 & 34 & 33 & 32 & 31 & 30 &
29 & 28 & 27 & 26 & 25 & 24 & 23 & 22 & 21 & 20 &
19 & 18 & 17 & 16 & 15 & 11 & 13 & 12 & 11 & 10 &
 9 &  8 &  7 &  6 &  5 &  4 &  3 &  2 &  1 &  0 \\
#1 \\
& & & & & & & & & & & & & & & & & & & & & & & & & & & & & & & & & & & & & & & & & & & & & & & & & & & & & & & & & & & \\
\hline
\end{tabular}
\end{center}}
}

\newcommand{\controlwordc}[2]{
{\scriptsize
%\sfdefault
\setlength{\tabcolsep}{0.7pt}
\begin{center}
\begin{tabular}{|C|C|C|C|C|C|C|C|C|C|C|C|C|C|C|C|C|C|C|C|C|C|C|C|C|C|C|C|C|C|C|C|C|C|C|C|C|C|C|C|C|C|C|C|C|C|C|C|C|C|C|C|C|C|C|C|C|C|C|C|}
\hline
59 & 58 & 57 & 56 & 55 & 54 & 53 & 52 & 51 & 50 &
49 & 48 & 47 & 46 & 45 & 44 & 43 & 42 & 41 & 40 &
39 & 38 & 37 & 36 & 35 & 34 & 33 & 32 & 31 & 30 &
29 & 28 & 27 & 26 & 25 & 24 & 23 & 22 & 21 & 20 &
19 & 18 & 17 & 16 & 15 & 11 & 13 & 12 & 11 & 10 &
 9 &  8 &  7 &  6 &  5 &  4 &  3 &  2 &  1 &  0 \\
#1 \\
& & & & & & & & & & & & & & & & & & & & & & & & & & & & & & & & & & & & & & & & & & & & & & & & & & & & & & & & & & & \\
\hline \multicolumn{1}{c}{} \\
#2 \\
\end{tabular}
\end{center}}
}

\newcommand{\controlworddesc}[1]{
\begin{center}
\begin{tabular}[t]{rrlTp{8.0cm}}
Length & \multicolumn{1}{l}{Bits} & Type & API & Description \\
\midrule
#1
\end{tabular}
\end{center}
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{document}

\title{TBM Format}
\author{Nicholas DeCicco}
\maketitle

\chapter{Overview}

\begin{figure}
	\centering
	\includegraphics{figures/layout/layout.pdf}
	\caption{Illustration of the general TBM file layout.}
	\label{Fig.TBMLayout}
\end{figure}

Bits 59--30 of word~29 (``offset to first file control pointer"; \texttt{firstFCPOff} in the API) of the SYSLBN block (which begins at offset 0) specify the offset, in 60-bit words, from the start of the file (offset 0) to the first file control pointer (see \cref{Sec.FileControlPointer}). Each file control pointer is followed by a set of file history words (see \cref{Sec.FileHistoryWords}). After the first set of file history words (which immediately follow the first file control pointer), and up to the second file control pointer is where a series of block control pointers (see \cref{Sec.BlockControlPointer}) reside. Each block control pointer is one 60-bit word in length, and there are \texttt{numBKBlocks} of them; as there are this many, one should find the following equivalencies:

\begin{align*}
	\mathtt{numBKBlocks} =
	\underbrace{\mathtt{nextFCPOff}}_{\shortstack[c]{
		From first file\\
		control pointer\\
		located at\\
		\texttt{firstFCPOff}
	}} - \; (\mathtt{firstFCPOff} + 9)
\end{align*}

The length of the file is indicated by the values of \texttt{numBKBlocks} and \texttt{bk} in \texttt{SYSLBN}. The length of the file should be:
\[
	\text{file length}_\text{8-bit bytes} = \dfrac{(\texttt{numBKBlocks} + 1) \times \texttt{bk} \times 2048_\text{60-bit words} \times 60_\text{bits per word}}{8_\text{bits per byte}} \mathrm{.}
\]

The portions of a TBM file where actual data resides are broken into many \textit{data records}; each data record is preceeded by a data buffer flags (see \cref{Sec.DataBufferFlag}) word, also known as a ``record control word." Each data buffer flag contains an offset (relative to it) specifying the location of the next data buffer flag (\texttt{nextPtrOffset} in the \texttt{DataBufferFlags} struct).

Actual data begins at one TLIB/BK block into the file (after some \texttt{DataBufferFlags} and \texttt{VOL1}/\texttt{HDR1}/\texttt{HDR2} metadata). The length of a TLIB block is
\begin{align*}
	\text{length}_\text{60-bit words} &= 2048 \times \texttt{bk} \mathrm{,} \\
	\text{length}_\text{64-bit words} &= \dfrac{2048 \times \texttt{bk} \times 60}{64} \mathrm{.}
\end{align*}

For example, for the default \texttt{bk} value of \(8\),
\begin{align*}
	\text{length}_\text{60-bit words} &= 2048 \times 8 = 16384 \text{ 60-bit words} \mathrm{,} \\
	\text{length}_\text{64-bit words} &= \dfrac{2048 \times 8 \times 60}{64} = 15360 \text{ 64-bit words} \mathrm{.}
\end{align*}

\chapter{Using \texttt{tbmexplore}}

\begin{lstlisting}[language=]
$ tbmexplore G51452
Enter an offset: 
\end{lstlisting}

\noindent We enter \texttt{0} and press enter, and are next prompted with:

\begin{lstlisting}[language=]
How would you like to display the data?

         1) 6-bit DPC
         2) Data Buffer Flags (aka ``Record Control Word")
         3) Block Control Pointer
         4) File Control Pointer
         5) File History Word
         6) SYSLBN
         7) NotQuiteSYSLBN
         8) VOL1
         9) HDR1
        10) HDR2
        11) 20-bit integers
        12) 60-bit integers

Enter a choice [1-12]: 
\end{lstlisting}

\noindent Choosing \texttt{6}, we see

\begin{lstlisting}[language=]
 ==== SYSLBN ====
offset = 0 (bits) 0+0 (8-bit bytes) 0+0 (60-bit words)
machineType        =       0 (CDC 7600)
density            =       0 (200 BPI)
dataType           =       0 (BCD as DPC)
numTracks          =       1
bk                 =       8
numBKBlocks        =     308
labelBufLen        =    1024
 ===== VOL1 =====
vol1               = "VOL1" (0x58F31C)
volSerialName1     = "G51452"
acc                = " " (45; unlimited access)
acntNum            = "41113306" (0x01F71C1C79E6E1)
sciNum             = "5&" (0x837)
tbmVolSerial       = "TL0483" (0x50C6DF8DE)
sysLevelCode       = " " (0x2D)
 ===== HDR1 =====
hdr1               = "HDR1" (0x20449C)
dataSetID          = "NCARSYSTEMHD10001"
volSerialName2     = "G51452"
fileSecNum         = "0001"
fileSeqNum         = "0001"
generationNum      = "0001"
versionNum         = "00"
creationDate       = " 82320"
expDate            = " 83320"
accChar            = " " (0x2D)
blockCount         = "000000"
sysCode            = "NCAR   SYSTEM"
 ===== HDR2 =====
hdr2               = "HDR2" (0x20449D)
hdr2label          = "                                                                            "
 ==== SYSLBN ====
fileCtrlPtrOff     =     0 ("     ")
blkCtrlPtrOff      =     0 ("     ")
firstFCPOff        =    51 ("    %")
ctrlCardOpenOff    =    35 ("    8")
openMergeAreaOff   =    35 ("    8")
curCtrlCardOpenOff =    35 ("    8")
fcpToBlkCtrlOff    =    10 ("    J")
\end{lstlisting}

\chapter{Reference}

\section{Accessability critera} \label{Sec.AccessibilityCriteria}

The accessability critera characters are a character which indicate ``any restrictions on who may have access to the information in this file. A space means unlimited access; any other character means special handling, in a manner to be defined."

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                                                                                     %
%                                        SYSLBN                                       %
%                                                                                     %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{SYSLBN}

A SYSLBN block appears at the start of every TBM file, at offset 0. The SYSLBN block could be thought of as being comprised of a header (words 0 through 3), a VOL1 label (words 4--11), a HDR1 label (words 12--19), a HDR2 label (words 27--28), and finally pointers to various locations in the file (words 28--30).

%%%%%%%%%%%%%%%%% WORD 0 (0-based indices) %%%%%%%%%%%%%%%%%%

\subsection{SYSLBN Word 0}

\controlword{
\multicolumn{4}{|c|}{\rotate{\shortstack[c]{Machine\\Type}}} &
\multicolumn{4}{c|}{Density} &
\multicolumn{8}{c|}{Data Type} &
\multicolumn{4}{c|}{Tracks} &
\multicolumn{8}{c|}{BK} &
\multicolumn{12}{c|}{\shortstack[l]{Number of data\\blocks each\\\(\text{BK} \times 2048\) words}} &
\multicolumn{20}{c|}{\shortstack[l]{Actual length of\\label buffer}}
}

\controlworddesc{
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
4 & 59--56 & Binary & machineType &
\begin{tabular}[t]{rl}
\multicolumn{2}{@{}l}{The machine type.} \\
0 & 7600 \\
1 & Cray-1 \\
2 & Front end
\end{tabular} \\
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
4 & 55--52 & Binary & density &
\begin{tabular}[t]{rl}
\multicolumn{2}{@{}l}{The original density.} \\
0 & 200 bpi \\
1 & 556 bpi \\
2 & 800 bpi \\
3 & 1600 bpi
\end{tabular} \\
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
8 & 51--44 & Binary & dataType &
\begin{tabular}[t]{rl}
\multicolumn{2}{@{}l}{The data type.} \\
0 & BCD as DPC \\
1 & Binary bit-serial \\
2 & BCD, no conversion from 7-channel stage-in \\
3 & ASCII \\
4 & EBCDIC
\end{tabular} \\
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
4 & 43--40 & Binary & numTracks &
\begin{tabular}[t]{rl}
\multicolumn{2}{@{}l}{The original number of tape tracks} \\
0 & 7-track \\
1 & 9-track
\end{tabular} \\
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
 8 & 39--32 & Binary & bk          & The value of BK from a TLIB card on the 7600 \\
12 & 31--20 & Binary & numBKBlocks & The number of BK length Data Blocks in this volume \\
20 & 19--0  & Binary & labelBufLen & Actual length of the label (SYSLBN) buffer
}

%%%%%%%%%%%%%%%%% WORD 1 (0-based indices) %%%%%%%%%%%%%%%%%%

\subsection{SYSLBN Word 1}

\controlword{
\multicolumn{60}{|c|}{Reserved}
}

\controlworddesc{
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
60 & 59--0 & --- & \textrm{---} & Reserved \\
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
}

%%%%%%%%%%%%%%%%% WORD 2 (0-based indices) %%%%%%%%%%%%%%%%%%

\subsection{SYSLBN Word 2}

This word is unused and should be set to zero.

\controlword{
\multicolumn{60}{|c|}{Open}
}

\controlworddesc{
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
60 & 59--0 & --- & \textrm{---} & Open \\
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
}

%%%%%%%%%%%%%%%%% WORD 3 (0-based indices) %%%%%%%%%%%%%%%%%%

\subsection{SYSLBN Word 3}

This word is unused and should be set to zero.

\controlword{
\multicolumn{60}{|c|}{Open}
}

\controlworddesc{
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
60 & 59--0 & --- & \textrm{---} & Open \\
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
}

%%%%%%%%%%%%%%%%% WORD 4 (0-based indices) %%%%%%%%%%%%%%%%%%

\subsection{SYSLBN Word 4 (VOL1 Word 0)}

\controlword{
\multicolumn{6}{|c|}{V} &
\multicolumn{6}{c|}{O} &
\multicolumn{6}{c|}{L} &
\multicolumn{6}{c|}{1} &
\multicolumn{6}{c|}{\(\text{VSN}_{1}\)} &
\multicolumn{6}{c|}{\(\text{VSN}_{2}\)} &
\multicolumn{6}{c|}{\(\text{VSN}_{3}\)} &
\multicolumn{6}{c|}{\(\text{VSN}_{4}\)} &
\multicolumn{6}{c|}{\(\text{VSN}_{5}\)} &
\multicolumn{6}{c|}{\(\text{VSN}_{6}\)}
}

\controlworddesc{
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
24 & 59--36 & DPC & vol1           & VOL1 characters for a Volume One label and the start of the Volume One label \\
36 & 35--0  & DPC & volSerialName1 & Six Volume Serial Name (VSN) characters
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
}

%%%%%%%%%%%%%%%%% WORD 5 (0-based indices) %%%%%%%%%%%%%%%%%%

\subsection{SYSLBN Word 5 (VOL1 Word 1)}

\controlword{
\multicolumn{6}{|c|}{ACC} &
\multicolumn{6}{c|}{--} &
\multicolumn{6}{c|}{--} &
\multicolumn{6}{c|}{--} &
\multicolumn{6}{c|}{--} &
\multicolumn{6}{c|}{--} &
\multicolumn{6}{c|}{--} &
\multicolumn{6}{c|}{--} &
\multicolumn{6}{c|}{--} &
\multicolumn{6}{c|}{--}
}

\controlworddesc{
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
 6 & 59--54 & DPC & acc          & Volume One label accessability criteria (see \cref{Sec.AccessibilityCriteria}) \\
54 & 53--0  & --- & \textrm{---} & Blank fill characters
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
}

%%%%%%%%%%%%%%%%% WORD 6 (0-based indices) %%%%%%%%%%%%%%%%%%

\subsection{SYSLBN Word 6 (VOL1 Word 2)}

\controlword{
\multicolumn{6}{|c|}{--} &
\multicolumn{6}{c|}{--} &
\multicolumn{6}{c|}{--} &
\multicolumn{6}{c|}{--} &
\multicolumn{6}{c|}{--} &
\multicolumn{6}{c|}{--} &
\multicolumn{6}{c|}{--} &
\multicolumn{6}{c|}{--} &
\multicolumn{6}{c|}{--} &
\multicolumn{6}{c|}{--}
}

\controlworddesc{
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
60 & 59--0 & --- & \textrm{---} & Blank fill characters \\
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
}

%%%%%%%%%%%%%%%%% WORD 7 (0-based indices) %%%%%%%%%%%%%%%%%%

\subsection{SYSLBN Word 7 (VOL1 Word 3)}

\controlword{
\multicolumn{6}{|c|}{--} &
\multicolumn{6}{c|}{--} &
\multicolumn{6}{c|}{--} &
\multicolumn{6}{c|}{--} &
\multicolumn{6}{c|}{--} &
\multicolumn{6}{c|}{--} &
\multicolumn{6}{c|}{--} &
\multicolumn{6}{c|}{\(\text{ACNT}_1\)} &
\multicolumn{6}{c|}{\(\text{ACNT}_2\)} &
\multicolumn{6}{c|}{\(\text{ACNT}_3\)}
}

\controlworddesc{
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
42 & 59--18 & --- & \textrm{---}  & Blank fill characters \\
18 & 17--0  & DPC & acntNum\_1\_3 & Characters 1--3 of the *JOB card accounting number \\
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
}

%%%%%%%%%%%%%%%%% WORD 8 (0-based indices) %%%%%%%%%%%%%%%%%%

\subsection{SYSLBN Word 8 (VOL1 Word 4)}

\controlword{
\multicolumn{6}{|c|}{\(\text{ACNT}_4\)} &
\multicolumn{6}{c|}{\(\text{ACNT}_5\)} &
\multicolumn{6}{c|}{\(\text{ACNT}_6\)} &
\multicolumn{6}{c|}{\(\text{ACNT}_7\)} &
\multicolumn{6}{c|}{\(\text{ACNT}_8\)} &
\multicolumn{6}{c|}{\(\text{SCI}_{1\text{--}2}\)} &
\multicolumn{6}{c|}{\(\text{SCI}_{3\text{--}4}\)} &
\multicolumn{6}{c|}{--} &
\multicolumn{6}{c|}{--} &
\multicolumn{6}{c|}{--}
}

\controlworddesc{
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
30 & 59--30 & DPC & acntNum\_4\_8 & Characters 4--8 of the *JOB card accounting number \\
12 & 29--18 & ?   & sciNum\_1\_4  & The scientist number from the *JOB card \\
18 & 17--0  & --- & \textrm{---}  & Blank fill characters
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
}

%%%%%%%%%%%%%%%%% WORD 9 (0-based indices) %%%%%%%%%%%%%%%%%%

\subsection{SYSLBN Word 9 (VOL1 Word 5)}

\controlword{
\multicolumn{6}{|c|}{--} &
\multicolumn{6}{c|}{--} &
\multicolumn{6}{c|}{--} &
\multicolumn{6}{c|}{--} &
\multicolumn{6}{c|}{--} &
\multicolumn{6}{c|}{--} &
\multicolumn{6}{c|}{--} &
\multicolumn{6}{c|}{--} &
\multicolumn{6}{c|}{--} &
\multicolumn{6}{c|}{--}
}

\controlworddesc{
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
60 & 59--0 & --- & \textrm{---} & Blank fill characters \\
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
}

%%%%%%%%%%%%%%%%% WORD 10 (0-based indices) %%%%%%%%%%%%%%%%%%

\subsection{SYSLBN Word 10 (VOL1 Word 6)}

\controlword{
\multicolumn{6}{|c|}{--} &
\multicolumn{6}{c|}{--} &
\multicolumn{6}{c|}{--} &
\multicolumn{6}{c|}{--} &
\multicolumn{6}{c|}{--} &
\multicolumn{6}{c|}{--} &
\multicolumn{6}{c|}{--} &
\multicolumn{6}{c|}{--} &
\multicolumn{6}{c|}{--} &
\multicolumn{6}{c|}{--}
}

\controlworddesc{
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
60 & 59--0 & --- & \textrm{---} & Blank fill characters \\
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
}


%%%%%%%%%%%%%%%%% WORD 11 (0-based indices) %%%%%%%%%%%%%%%%%%

\subsection{SYSLBN Word 11 (VOL1 Word 7)}

\controlword{
\multicolumn{6}{|c|}{MVM} &
\multicolumn{6}{c|}{MVM} &
\multicolumn{6}{c|}{MVM} &
\multicolumn{6}{c|}{MVM} &
\multicolumn{6}{c|}{MVM} &
\multicolumn{6}{c|}{MVM} &
\multicolumn{6}{c|}{--} &
\multicolumn{6}{c|}{--} &
\multicolumn{6}{c|}{--} &
\multicolumn{6}{c|}{L}
}

\controlworddesc{
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
36 & 59--24 & DPC & tbmVolSerial & TBM Volume Serial Name \\
18 & 23--6  & --- & \textrm{---} & Blank fill characters \\
 6 &  5--0  & DPC & sysLevelCode & System level code
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
}

%%%%%%%%%%%%%%%%% WORD 12 (0-based indices) %%%%%%%%%%%%%%%%%%

\subsection{SYSLBN Word 12 (HDR1 Word 0)}

This word marks the beginning of the ``header one label," which is 80 6-bit characters long.

\controlwordc{
\multicolumn{6}{|c|}{H} &
\multicolumn{6}{c|}{D} &
\multicolumn{6}{c|}{R} &
\multicolumn{6}{c|}{1} &
\multicolumn{6}{c|}{\shortstack[c]{\(\text{ID}_{1}\)\\ N}} &
\multicolumn{6}{c|}{\shortstack[c]{\(\text{ID}_{2}\)\\ C}} &
\multicolumn{6}{c|}{\shortstack[c]{\(\text{ID}_{3}\)\\ A}} &
\multicolumn{6}{c|}{\shortstack[c]{\(\text{ID}_{4}\)\\ R}} &
\multicolumn{6}{c|}{\shortstack[c]{\(\text{ID}_{5}\)\\ S}} &
\multicolumn{6}{c|}{\shortstack[c]{\(\text{ID}_{6}\)\\ Y}}
}{
\multicolumn{6}{c}{1} &
\multicolumn{6}{c}{2} &
\multicolumn{6}{c}{3} &
\multicolumn{6}{c}{4} &
\multicolumn{6}{c}{5} &
\multicolumn{6}{c}{6} &
\multicolumn{6}{c}{7} &
\multicolumn{6}{c}{8} &
\multicolumn{6}{c}{9} &
\multicolumn{6}{c}{10}
}

\controlworddesc{
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
24 & 59--36 & DPC & hdr1            & HDR1 characters for a Header One label and the start of the first Header One label \\
36 & 35--0  & DPC & dataSetID\_1\_6 & Data Set Identifier (DSI) characters 1--6
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
}

%%%%%%%%%%%%%%%%% WORD 13 (0-based indices) %%%%%%%%%%%%%%%%%%

\subsection{SYSLBN Word 13 (HDR1 Word 1)}

\controlwordc{
\multicolumn{6}{|c|}{\shortstack[c]{\(\text{ID}_{7}\)\\ S}} &
\multicolumn{6}{c|}{\shortstack[c]{\(\text{ID}_{8}\)\\ T}} &
\multicolumn{6}{c|}{\shortstack[c]{\(\text{ID}_{9}\)\\ E}} &
\multicolumn{6}{c|}{\shortstack[c]{\(\text{ID}_{10}\)\\ M}} &
\multicolumn{6}{c|}{\shortstack[c]{\(\text{ID}_{11}\)\\ H}} &
\multicolumn{6}{c|}{\shortstack[c]{\(\text{ID}_{12}\)\\ D}} &
\multicolumn{6}{c|}{\shortstack[c]{\(\text{ID}_{13}\)\\ 1}} &
\multicolumn{6}{c|}{\shortstack[c]{\(\text{ID}_{14}\)\\ 0}} &
\multicolumn{6}{c|}{\shortstack[c]{\(\text{ID}_{15}\)\\ 0}} &
\multicolumn{6}{c|}{\shortstack[c]{\(\text{ID}_{16}\)\\ 0}}
}{
\multicolumn{6}{c}{11} &
\multicolumn{6}{c}{12} &
\multicolumn{6}{c}{13} &
\multicolumn{6}{c}{14} &
\multicolumn{6}{c}{15} &
\multicolumn{6}{c}{16} &
\multicolumn{6}{c}{17} &
\multicolumn{6}{c}{18} &
\multicolumn{6}{c}{19} &
\multicolumn{6}{c}{20}
}

\controlworddesc{
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\multirow{2}{*}{60} & \multirow{2}{*}{59--0} & \multirow{2}{*}{DPC} & dataSetID\_7\_12 & \multirow{2}{*}{Data Set Identifier (DSI) characters 7--16} \\
& & & dataSetID\_13\_16 \\
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
}

%%%%%%%%%%%%%%%%% WORD 14 (0-based indices) %%%%%%%%%%%%%%%%%%

\subsection{SYSLBN Word 14 (HDR1 Word 2)}

\controlwordc{
\multicolumn{6}{|c|}{\shortstack[c]{\(\text{ID}_{17}\)\\ 1}} &
\multicolumn{6}{c|}{\(\text{VSN}_{1}\)} &
\multicolumn{6}{c|}{\(\text{VSN}_{2}\)} &
\multicolumn{6}{c|}{\(\text{VSN}_{3}\)} &
\multicolumn{6}{c|}{\(\text{VSN}_{4}\)} &
\multicolumn{6}{c|}{\(\text{VSN}_{5}\)} &
\multicolumn{6}{c|}{\(\text{VSN}_{6}\)} &
\multicolumn{6}{c|}{\(\text{FSN}_{1}\)} &
\multicolumn{6}{c|}{\(\text{FSN}_{2}\)} &
\multicolumn{6}{c|}{\(\text{FSN}_{3}\)}
}{
\multicolumn{6}{c}{21} &
\multicolumn{6}{c}{22} &
\multicolumn{6}{c}{23} &
\multicolumn{6}{c}{24} &
\multicolumn{6}{c}{25} &
\multicolumn{6}{c}{26} &
\multicolumn{6}{c}{27} &
\multicolumn{6}{c}{28} &
\multicolumn{6}{c}{29} &
\multicolumn{6}{c}{30}
}

\controlworddesc{
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
 6 & 59--54 & DPC & dataSetID\_17    & Data Set Identifier (DSI) character 17 \\
36 & 54--18 & DPC & volSerialName2   & Volume Serial Name characters 1--6, equal to the ones in word 4, bits 59--36 \\
18 & 17--0  & DPC & fileSecNum\_1\_3 & File section number characters 1--3
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
}

%%%%%%%%%%%%%%%%% WORD 15 (0-based indices) %%%%%%%%%%%%%%%%%%

\subsection{SYSLBN Word 15 (HDR1 Word 3)}

\controlwordc{
\multicolumn{6}{|c|}{\(\text{FSN}_{4}\)} &
\multicolumn{6}{c|}{\(\text{FQN}_{1}\)} &
\multicolumn{6}{c|}{\(\text{FQN}_{2}\)} &
\multicolumn{6}{c|}{\(\text{FQN}_{3}\)} &
\multicolumn{6}{c|}{\(\text{FQN}_{4}\)} &
\multicolumn{6}{c|}{\(\text{VSN}_{1}\)} &
\multicolumn{6}{c|}{\(\text{FSN}_{2}\)} &
\multicolumn{6}{c|}{\(\text{FSN}_{3}\)} &
\multicolumn{6}{c|}{\(\text{FSN}_{4}\)} &
\multicolumn{6}{c|}{\(\text{VN}_{1}\)}
}{
\multicolumn{6}{c}{31} &
\multicolumn{6}{c}{32} &
\multicolumn{6}{c}{33} &
\multicolumn{6}{c}{34} &
\multicolumn{6}{c}{35} &
\multicolumn{6}{c}{36} &
\multicolumn{6}{c}{37} &
\multicolumn{6}{c}{38} &
\multicolumn{6}{c}{39} &
\multicolumn{6}{c}{40}
}

\controlworddesc{
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
 6 & 59--54 & DPC & fileSecNum\_4 & File section number character 4 \\
24 & 53--30 & DPC & fileSeqNum    & File sequence number characters 1--4 \\
24 & 29--6  & DPC & generationNum & Generation number characters 1--4 \\
 6 &  5--0  & DPC & versionNum\_1 & Version number character 1
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
}

%%%%%%%%%%%%%%%%% WORD 16 (0-based indices) %%%%%%%%%%%%%%%%%%

\subsection{SYSLBN Word 16 (HDR1 Word 4)}

\controlwordc{
\multicolumn{6}{|c|}{\(\text{VN}_{2}\)} &
\multicolumn{6}{c|}{\(\text{CD}_{1}\)} &
\multicolumn{6}{c|}{\(\text{CD}_{2}\)} &
\multicolumn{6}{c|}{\(\text{CD}_{3}\)} &
\multicolumn{6}{c|}{\(\text{CD}_{4}\)} &
\multicolumn{6}{c|}{\(\text{CD}_{5}\)} &
\multicolumn{6}{c|}{\(\text{CD}_{6}\)} &
\multicolumn{6}{c|}{\(\text{ED}_{1}\)} &
\multicolumn{6}{c|}{\(\text{ED}_{2}\)} &
\multicolumn{6}{c|}{\(\text{ED}_{3}\)}
}{
\multicolumn{6}{c}{41} &
\multicolumn{6}{c}{42} &
\multicolumn{6}{c}{43} &
\multicolumn{6}{c}{44} &
\multicolumn{6}{c}{45} &
\multicolumn{6}{c}{46} &
\multicolumn{6}{c}{47} &
\multicolumn{6}{c}{48} &
\multicolumn{6}{c}{49} &
\multicolumn{6}{c}{50}
}

\controlworddesc{
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
 6 & 59--54 & DPC & versionNum\_2 & Version number character 2 \\
36 & 53--18 & DPC & creationDate  & Creation date characters 1--6 \\
18 & 17--0  & DPC & expDate\_1\_3 & Expiration date characters 1--3
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
}

%%%%%%%%%%%%%%%%% WORD 17 (0-based indices) %%%%%%%%%%%%%%%%%%

\subsection{SYSLBN Word 17 (HDR1 Word 5)}

\controlwordc{
\multicolumn{6}{|c|}{\(\text{ED}_{4}\)} &
\multicolumn{6}{c|}{\(\text{ED}_{5}\)} &
\multicolumn{6}{c|}{\(\text{ED}_{6}\)} &
\multicolumn{6}{c|}{ACC} &
\multicolumn{6}{c|}{\(\text{BC}_{1}\)} &
\multicolumn{6}{c|}{\(\text{BC}_{2}\)} &
\multicolumn{6}{c|}{\(\text{BC}_{3}\)} &
\multicolumn{6}{c|}{\(\text{BC}_{4}\)} &
\multicolumn{6}{c|}{\(\text{BC}_{5}\)} &
\multicolumn{6}{c|}{\(\text{BC}_{6}\)}
}{
\multicolumn{6}{c}{51} &
\multicolumn{6}{c}{52} &
\multicolumn{6}{c}{53} &
\multicolumn{6}{c}{54} &
\multicolumn{6}{c}{55} &
\multicolumn{6}{c}{56} &
\multicolumn{6}{c}{57} &
\multicolumn{6}{c}{58} &
\multicolumn{6}{c}{59} &
\multicolumn{6}{c}{60}
}

\controlworddesc{
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
18 & 59--42 & DPC & expDate\_4\_6 & Expiration date characters 4--6 \\
 6 & 41--36 & DPC & accChar       & The HDR1 accessability criteria character (see \cref{Sec.AccessibilityCriteria}) \\
36 & 35--0  & DPC & blockCount    & The block count characters
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
}

%%%%%%%%%%%%%%%%% WORD 18 (0-based indices) %%%%%%%%%%%%%%%%%%

\subsection{SYSLBN Word 18 (HDR1 Word 6)}

\controlwordc{
\multicolumn{6}{|c|}{\(\text{SC}_{1}\)} &
\multicolumn{6}{c|}{\(\text{SC}_{2}\)} &
\multicolumn{6}{c|}{\(\text{SC}_{3}\)} &
\multicolumn{6}{c|}{\(\text{SC}_{4}\)} &
\multicolumn{6}{c|}{\(\text{SC}_{5}\)} &
\multicolumn{6}{c|}{\(\text{SC}_{6}\)} &
\multicolumn{6}{c|}{\(\text{SC}_{7}\)} &
\multicolumn{6}{c|}{\(\text{SC}_{8}\)} &
\multicolumn{6}{c|}{\(\text{SC}_{9}\)} &
\multicolumn{6}{c|}{\(\text{SC}_{10}\)}
}{
\multicolumn{6}{c}{61} &
\multicolumn{6}{c}{62} &
\multicolumn{6}{c}{63} &
\multicolumn{6}{c}{64} &
\multicolumn{6}{c}{65} &
\multicolumn{6}{c}{66} &
\multicolumn{6}{c}{67} &
\multicolumn{6}{c}{68} &
\multicolumn{6}{c}{69} &
\multicolumn{6}{c}{70}
}

\controlworddesc{
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
60 & 59--42 & DPC & sysCode\_1\_10 & System code characters 1--10
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
}

%%%%%%%%%%%%%%%%% WORD 19 (0-based indices) %%%%%%%%%%%%%%%%%%

\subsection{SYSLBN Word 19 (HDR1 Word 7)}

\controlwordc{
\multicolumn{6}{|c|}{\(\text{SC}_{11}\)} &
\multicolumn{6}{c|}{\(\text{SC}_{12}\)} &
\multicolumn{6}{c|}{\(\text{SC}_{13}\)} &
\multicolumn{6}{c|}{--} &
\multicolumn{6}{c|}{--} &
\multicolumn{6}{c|}{--} &
\multicolumn{6}{c|}{--} &
\multicolumn{6}{c|}{--} &
\multicolumn{6}{c|}{--} &
\multicolumn{6}{c|}{--}
}{
\multicolumn{6}{c}{71} &
\multicolumn{6}{c}{72} &
\multicolumn{6}{c}{73} &
\multicolumn{6}{c}{74} &
\multicolumn{6}{c}{75} &
\multicolumn{6}{c}{76} &
\multicolumn{6}{c}{77} &
\multicolumn{6}{c}{78} &
\multicolumn{6}{c}{79} &
\multicolumn{6}{c}{80}
}

\controlworddesc{
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
18 & 59--42 & DPC & sysCode\_11\_13 & System code characters 11--13 \\
42 & 41--0  & --- & \textrm{---}    & Spaces \\
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
}

%%%%%%%%%%%%%%% WORD 20-27  (0-based indices) %%%%%%%%%%%%%%%%

\subsection{SYSLBN Words 20--27 (HDR2 Words 0--7)}

These words contain the HDR2 label.

\controlword{
\multicolumn{6}{|c|}{H} &
\multicolumn{6}{c|}{D} &
\multicolumn{6}{c|}{R} &
\multicolumn{6}{c|}{2} &
\multicolumn{6}{c|}{--} &
\multicolumn{6}{c|}{--} &
\multicolumn{6}{c|}{--} &
\multicolumn{6}{c|}{--} &
\multicolumn{6}{c|}{--} &
\multicolumn{6}{c|}{--}
}

%%%%%%%%%%%%%%%%% WORD 28 (0-based indices) %%%%%%%%%%%%%%%%%%

\subsection{SYSLBN Word 28}

\controlword{
\multicolumn{30}{|c|}{Offset to current FCP} &
\multicolumn{30}{c|}{Offset to current BCP}
}

\controlworddesc{
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
30 & 59--30 & Binary & fileCtrlPtrOff & Offset to current file control pointer \\
30 & 29--0  & Binary & blkCtrlPtrOff  & Offset to current block control pointer from SYSMSI \\
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
}

%%%%%%%%%%%%%%%%% WORD 29 (0-based indices) %%%%%%%%%%%%%%%%%%

\subsection{SYSLBN Word 29}

\controlword{
\multicolumn{30}{|c|}{Offset to first file control pointer} &
\multicolumn{30}{c|}{Offset to control card ``open" area}
}

\controlworddesc{
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
30 & 59--30 & Binary & firstFCPOff     & Offset to first file control pointer \\
30 & 29--0  & Binary & ctrlCardOpenOff & Offset to control card ``open" area \\
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
}

%%%%%%%%%%%%%%%%% WORD 30 (0-based indices) %%%%%%%%%%%%%%%%%%

\subsection{SYSLBN Word 30}

\controlword{
\multicolumn{30}{|c|}{Offset to ``open" merge area} &
\multicolumn{30}{c|}{Offset to current open control card area}
}

\controlworddesc{
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
30 & 59--30 & Binary & openMergeAreaOff   & Offset to ``open" merge area \\
30 & 29--0  & Binary & curCtrlCardOpenOff & Offset to current open control card area \\
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
}

%%%%%%%%%%%%%%%%% WORD 31 (0-based indices) %%%%%%%%%%%%%%%%%%

\subsection{SYSLBN Word 31}

Note that \texttt{fcpToBlkCtrlOff} appears to be off by one; it has a value of 10 when it should be 9.

\controlword{
\multicolumn{30}{|c|}{Unused} &
\multicolumn{30}{c|}{Offset from FCP to first BCP}
}

\controlworddesc{
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
30 & 59--30 & ---    & \textrm{---}    & Unused \\
30 & 29--0  & Binary & fcpToBlkCtrlOff & Offset from File Control Pointer to first Block Control Pointer \\
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                                                                                     %
%                                FILE CONTROL POINTERS                                %
%                                                                                     %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{File Control Pointers} \label{Sec.FileControlPointer}

\controlword{
\rotate{Is EOF} &
\rotate{Is Obsolete} &
\multicolumn{3}{c|}{\rotate{\shortstack[c]{Secondary\\file type}}} &
\multicolumn{3}{c|}{\rotate{Disposition}} &
\multicolumn{3}{c|}{\rotate{File type}} &
\multicolumn{4}{c|}{Open} &
\multicolumn{21}{c|}{\shortstack[c]{Location of Pointer\\Preceding HDR1 label\\in Data Buffer}} &
\multicolumn{12}{c|}{\shortstack[c]{Block num.\\where file\\starts}} &
\multicolumn{12}{c|}{Words to next ID}
}

\controlworddesc{
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
1 & 59 & Binary & isEOF      & If set, this FCP indicates EOF; no other bits used. \\
1 & 58 & Binary & isObsolete & If set, file is obsolete \\
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
3 & 57--55 & Binary & secondaryFileType &
\begin{tabular}[t]{rl}
\multicolumn{2}{@{}l}{Secondary file type} \\
1 & old \\
2 & new \\
4 & scatch
\end{tabular} \\
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
3 & 54-52 & Binary & fileDisposition &
\begin{tabular}[t]{rl}
\multicolumn{2}{@{}l}{File disposition} \\
0 & keep \\
1 & delete at close \\
2 & delete at termination
\end{tabular} \\
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
3 & 51-49 & Binary & fileType &
\begin{tabular}[t]{rl}
\multicolumn{2}{@{}l}{File type} \\
0 & undefined \\
1 & sequential access \\
2 & direct access \\
3 & mixed access
\end{tabular} \\
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
 4 & 48--45 & ---    & \textrm{---}    & Open \\
21 & 44--24 & Binary & bufferPtrOffset & Location of buffer pointer preceding the HDR1 label for this file \\
12 & 23--12 & Binary & dataBlkNum      & Data block number where the file starts \\
12 & 11--0  & Binary & nextFCPOff      & Words to next file control pointer
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                                                                                     %
%                                FILE HISTORY WORDS                                   %
%                                                                                     %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{File History Words} \label{Sec.FileHistoryWords}

The file histoy words immediately follow every file control pointer.

%%%%%%%%%%%%%%%%% WORD 1 (1-based indices) %%%%%%%%%%%%%%%%%%

\subsection{File History Word 1}

\controlword{
\multicolumn{6}{|c|}{\shortstack[c]{\(\text{ID}_{1}\)\\ N}} &
\multicolumn{6}{c|}{\shortstack[c]{\(\text{ID}_{2}\)\\ C}} &
\multicolumn{6}{c|}{\shortstack[c]{\(\text{ID}_{3}\)\\ A}} &
\multicolumn{6}{c|}{\shortstack[c]{\(\text{ID}_{4}\)\\ R}} &
\multicolumn{6}{c|}{\shortstack[c]{\(\text{ID}_{5}\)\\ S}} &
\multicolumn{6}{c|}{\shortstack[c]{\(\text{ID}_{6}\)\\ Y}} &
\multicolumn{6}{c|}{\shortstack[c]{\(\text{ID}_{7}\)\\ S}} &
\multicolumn{6}{c|}{\shortstack[c]{\(\text{ID}_{8}\)\\ T}} &
\multicolumn{6}{c|}{\shortstack[c]{\(\text{ID}_{9}\)\\ E}} &
\multicolumn{6}{c|}{\shortstack[c]{\(\text{ID}_{10}\)\\ M}}
}

\controlworddesc{
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
60 & 59--0 & DPC & dataSetID\_1\_10 & Characters 1--10 of the Data Set Identifier (DSI) from the current HDR1 label \\
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
}

%%%%%%%%%%%%%%%%% WORD 2 (1-based indices) %%%%%%%%%%%%%%%%%%

\subsection{File History Word 2}

\controlword{
\multicolumn{6}{|c|}{\shortstack[c]{\(\text{ID}_{11}\)\\ H}} &
\multicolumn{6}{c|}{\shortstack[c]{\(\text{ID}_{12}\)\\ D}} &
\multicolumn{6}{c|}{\shortstack[c]{\(\text{ID}_{13}\)\\ 1}} &
\multicolumn{6}{c|}{\shortstack[c]{\(\text{ID}_{14}\)\\ 0}} &
\multicolumn{6}{c|}{\shortstack[c]{\(\text{ID}_{15}\)\\ 0}} &
\multicolumn{6}{c|}{\shortstack[c]{\(\text{ID}_{16}\)\\ 0}} &
\multicolumn{6}{c|}{\shortstack[c]{\(\text{ID}_{17}\)\\ 1}} &
\multicolumn{6}{c|}{--} &
\multicolumn{6}{c|}{--} &
\multicolumn{6}{c|}{--}
}

\controlworddesc{
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
42 & 59--24 & DPC & dataSetID\_13\_17 & Characters 11--17 of the Data Set Identifier (DSI) from the current HDR1 label \\
18 & 17--0  & --- & \textrm{---} & Spaces \\
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
}

%%%%%%%%%%%%%%%%% WORD 3 (1-based indices) %%%%%%%%%%%%%%%%%%

\subsection{File History Word 3}

\controlword{
\multicolumn{15}{|c|}{Last time file read} &
\multicolumn{9}{c|}{\shortstack[c]{Last day\\file read}} &
\multicolumn{6}{c|}{\shortstack[c]{Last year\\file read}} &
\multicolumn{15}{c|}{Last time file written} &
\multicolumn{9}{c|}{\shortstack[c]{Last day\\file written}} &
\multicolumn{6}{c|}{\shortstack[c]{Last year\\file written}}
}

\controlworddesc{
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
15 & 59--45 & Binary & lastReadTime  & Last time the file was read \\
 9 & 44--36 & Binary & lastReadDay   & Last day of year file was read \\
 6 & 35--30 & Binary & lastReadYear  & Last year file was read (\(0 = 1976\)) \\
15 & 29--15 & Binary & lastWriteTime & Last time the file was written \\
 9 & 14--6  & Binary & lastWriteDay  & Last day of year file was written \\
 6 &  5--0  & Binary & lastWriteYear & Last year file was written (\(0 = 1976\)) \\
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
}

%%%%%%%%%%%%%%%%% WORD 4 (1-based indices) %%%%%%%%%%%%%%%%%%

\subsection{File History Word 4}

\controlword{
\multicolumn{36}{|c|}{Open} &
\multicolumn{12}{c|}{Use Count} &
\multicolumn{12}{c|}{Version/generation number}
}

\controlworddesc{
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
36 & 59--24 & ---    & \textrm{---} & Open \\
12 & 23--12 & Binary & useCount   & Use count; i.e., the number of times the file was referenced. Needed for PLIB. \\
12 & 11--0  & Binary & versionNum & Version number/generation number \\
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
}

%%%%%%%%%%%%%%%%% WORD 5 (1-based indices) %%%%%%%%%%%%%%%%%%

\subsection{File History Word 5}

\controlword{
\multicolumn{30}{|c|}{Password for reading} &
\multicolumn{30}{c|}{Password for writing}
}

\controlworddesc{
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
30 & 59--30 & DPC & readPasswd  & Password for reading \\
30 & 29--0  & DPC & writePasswd & Password for writing \\
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
}

%%%%%%%%%%%%%%%%% WORD 6 (1-based indices) %%%%%%%%%%%%%%%%%%

\subsection{File History Word 6}

\controlword{
\multicolumn{30}{|c|}{Record length} &
\multicolumn{30}{c|}{Maximum Record Number}
}

\controlworddesc{
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
30 & 59--30 & Binary & recordLen    & Record length \\
30 & 29--0  & Binary & maxRecordNum & Maximum record number \\
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
}

%%%%%%%%%%%%%%%%% WORD 7 (1-based indices) %%%%%%%%%%%%%%%%%%

\subsection{File History Word 7}

\controlword{
\multicolumn{12}{|c|}{Creation year in DPC} &
\multicolumn{18}{c|}{Creation day in DPC} &
\multicolumn{12}{c|}{Expiration year in DPC} &
\multicolumn{18}{c|}{Expiration day in DPC}
}

\controlworddesc{
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
12 & 59--48 & DPC & creationYear   & Creation year \\
18 & 47--30 & DPC & creationDay    & Creation day \\
12 & 29--18 & DPC & expirationYear & Expiration year \\
18 & 17--0  & DPC & expirationDay  & Expiration day \\
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
}

%%%%%%%%%%%%%%%%% WORD 8 (1-based indices) %%%%%%%%%%%%%%%%%%

\subsection{File History Word 8}

\controlword{
\multicolumn{60}{|c|}{Open}
}

\controlworddesc{
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
60 & 59--0 & --- & \textrm{---} & Open \\
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                                                                                     %
%                                BLOCK CONTROL POINTERS                               %
%                                                                                     %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Block Control Pointer (BCP)} \label{Sec.BlockControlPointer}

\controlword{
\rotate{No Rec. Start} &
\multicolumn{2}{c}{\rotate{Open}} &
\multicolumn{12}{|c|}{Checksum} &
\multicolumn{21}{c|}{Last record in data block N} &
\multicolumn{24}{c|}{Words to first pointer in data block N}
}

\controlworddesc{
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
 1 & 59     & Binary & noRecordStartsHere & If set, no record starts in this block. \\
 2 & 58--57 & ---    & \textrm{---}       & Open \\
12 & 56--45 & Binary & checksum           & Checksum\footnotemark \\
21 & 44--24 & Binary & lastRecord         & Last record starting in data block N \\
24 & 23--0  & Binary & wordsToFirstPtr    & Words to first pointer in data block N \\
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
}
\footnotetext{Not mentioned in the NCAR Tech Note, but can be seen referenced on line 96 of the \texttt{as.s} CAL source file for \texttt{tbm2cos}.}

\subsection{Further Remarks}

\subsubsection{Representation in NCAR Technical Note}

Note that the way the block control pointer is depicted in the NCAR Technical Note is rather confusing; the technical note shows what at first appear to be three distinct ``block control pointers," one which is ``word 9", another which is word ``\(+9+M-1\)", and another which is word ``\(+9+M\)". Really what the technical note is trying to convey is that there are \(M\) block control pointers (equal to \texttt{bk}); the first block control pointer starts at an offset \(+9\) after the first file control pointer; and immediately after the last block control pointer (\(+9+M\)) is another file control pointer.

\subsubsection{\texttt{lastRecord}}

\texttt{lastRecord} is the one-based index of the last record to appear in the \(\mathtt{bk} \times 2048\)-sized data block corresponding to a given buffer control pointer. For example, using \texttt{tbmexplore} to view the first three buffer control pointers shows that the ``last record in data block N" for these are 35, 72, and 108.

\begin{lstlisting}[language=]
          | no record   |          | last record in | words to first pointer
offset    | starts here | checksum | data block N   | in data block N
==========+=============+==========+================+========================
       60 |           0 |     3496 |             35 |                    220
       61 |           0 |     2517 |             72 |                    365
       62 |           0 |     2696 |            108 |                    520

\end{lstlisting}

Using \texttt{tbmexplore} to dump the offsets of the data buffer flags containing actual data in the same file, then taking those offsets mod 16384 to show where the offsets cross block boundaries, we can see that the indices of the records at the end of each block correspond to the aforementioned values:

\begin{center}
\includegraphics{figures/lastrecord/lastrecord.pdf}
\end{center}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                                                                                     %
%                                  DATA BUFFER FLAGS                                  %
%                                                                                     %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Data Buffer Flags} \label{Sec.DataBufferFlag}

Also known as the ``record control word" or the ``data buffer field."

\controlword{
\rotate{Record start} &
\rotate{EOD} &
\rotate{EOF} &
\rotate{Load point} &
\rotate{Label rec. follows} &
\rotate{EOL} &
\rotate{Parity error} &
\rotate{Rec. not written} &
\rotate{Rec. short} &
\multicolumn{6}{c|}{\shortstack[c]{No. bits.\\in last\\ dataword}} &
\multicolumn{5}{c|}{\shortstack[c]{Mode\\of\\data}} &
\multicolumn{19}{c|}{Words to previous pointer} &
\multicolumn{21}{c|}{Words to next pointer}
}

\controlworddesc{
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
 1 &     59 & Binary & isRecordStart              & Start of record \\
 1 &     58 & Binary & isEOD                      & End of data in this volume \\
 1 &     57 & Binary & isEOF                      & End of file \\
 1 &     56 & Binary & isLoadPoint                & Load point for tape simulation \\
 1 &     55 & Binary & labelRecordFollows         & Label record follows \\
 1 &     54 & Binary & endLabelGroup              & End of label group file mark \\
 1 &     53 & Binary & sourceRecordHasParityError & Source record had a parity error \\
 1 &     52 & Binary & recordNotWritten           & Record not written (direct access volume) \\
 1 &     51 & Binary & recordIsShorter            & Record shorter than words to next pointer-1, length is in bits 0-21 of first data word \\
 6 & 50--45 & Binary & numBits                    & Number of bits in last data word controlled by this pointer \\
 5 & 44--40 & Binary & recordDataMode             & Mode of data in this record (see Data Type bits 51--44 of first word of SYSLBN) \\
19 & 39--21 & Binary & prevPtrOffset              & Words to previous buffer pointer \\
21 & 20--0  & Binary & nextPtrOffset              & Words to next buffer pointer \\
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                                                                                     %
%                               FIRST END-OF-FILE LABEL                               %
%                                                                                     %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{First End-Of-File Label (EOF1)}

All of the characters in EOF1 correspond directly to those in HDR1, but only characters 5--54 and 61--80 of EOF1 will have the (exact) same values as those of HDR1 in a given file; characters 55-60 contain the block count, which changes between HDR1 and EOF1. Characters 1--4 change from \texttt{HDR1} to \texttt{EOF1}, so only the first word (word 0) of EOF1 is shown.

For comparison, consider the HDR1 and EOF1 at the offsets shown in the table below from the CODE-II file \texttt{G51452}:

\begin{center}
\begin{tabular}{lll}
Field                       & HDR1 Value                          & EOF1 Value \\
\midrule
Offset\footnotemark         & 16394                               & 5050071 \\
\texttt{hdr1}/\texttt{eof1} & \texttt{"HDR1"} (\texttt{0x20449C}) & \texttt{"EOF1"} (\texttt{0x14F19C}) \\
\texttt{dataSetID}          & \texttt{"NCARSYSTEMHD10001"}        & \texttt{"NCARSYSTEMHD10001"} \\
\texttt{volSerialName2}     & \texttt{"G51452"}                   & \texttt{"G51452"} \\
\texttt{fileSecNum}         & \texttt{"0001"}                     & \texttt{"0001"} \\
\texttt{fileSeqNum}         & \texttt{"0001"}                     & \texttt{"0001"} \\
\texttt{generationNum}      & \texttt{"0001"}                     & \texttt{"0001"} \\
\texttt{versionNum}         & \texttt{"00"}                       & \texttt{"00"} \\
\texttt{creationDate}       & \texttt{" 82320"}                   & \texttt{" 82320"} \\
\texttt{expDate}            & \texttt{" 83320"}                   & \texttt{" 83320"} \\
\texttt{accChar}            & \texttt{" "} (\texttt{0x2D})        & \texttt{" "} (\texttt{0x2D}) \\
{\tikz[remember picture] \node [inner sep=0pt] (bca) {\texttt{blockCount}};} &
\texttt{"000000"} &
{\tikz[remember picture] \node [inner sep=0pt] (bcb) {\texttt{"011259"}};} \\
\texttt{sysCode}           & \texttt{"NCAR   SYSTEM"}            & \texttt{"NCAR   SYSTEM"}
\end{tabular}
\begin{tikzpicture}[overlay,remember picture,every node/.style={draw,red,thick,rectangle,rounded corners,inner sep=2pt}]
\node [fit=(bca.north west) (bcb.south east)] {};
\end{tikzpicture}
\footnotetext{``Offset" here is not a field in HDR1 or EOF1, but rather the offset in the file to the start of each of these sequences.}
\end{center}

Observe that the block count changes from 0 to 11259; in this file, there are 11259 records between HDR1 and EOF1.

\subsection{EOF1 Word 0}

\controlword{
\multicolumn{6}{|c|}{E} &
\multicolumn{6}{c|}{O} &
\multicolumn{6}{c|}{F} &
\multicolumn{6}{c|}{1} &
\multicolumn{6}{c|}{\shortstack[c]{\(\text{ID}_{1}\)\\ N}} &
\multicolumn{6}{c|}{\shortstack[c]{\(\text{ID}_{2}\)\\ C}} &
\multicolumn{6}{c|}{\shortstack[c]{\(\text{ID}_{3}\)\\ A}} &
\multicolumn{6}{c|}{\shortstack[c]{\(\text{ID}_{4}\)\\ R}} &
\multicolumn{6}{c|}{\shortstack[c]{\(\text{ID}_{5}\)\\ S}} &
\multicolumn{6}{c|}{\shortstack[c]{\(\text{ID}_{6}\)\\ Y}}
}

\controlworddesc{
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
18 & 59--42 & & & \\
42 & 41--0  & & & Same as in HDR1. \\
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
}

\end{document}
